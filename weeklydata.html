<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<META HTTP-EQUIV="REFRESH" CONTENT="180">
		<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
		<title>Weekly Data</title>
		
		
		<!-- 1. Add these JavaScript inclusions in the head of your page -->
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
		<script type="text/javascript" src="/js/highcharts.js"></script>		
		
		<!-- 2. Add the JavaScript to initialize the chart on document ready -->
<script type="text/javascript">
	$(document).ready(function() {

//load .txt files into series

$.ajax({
        url:'http://macca.myreef.info/weekly_average_ph.txt',
        async:false,
        success: function(data){
                phseries = data.split(',');
        }
});
$.ajax({
        url:'http://macca.myreef.info/weekly_average_orp.txt',
        async:false,
        success: function(data){
                orpseries = data.split(',');
        }
});
$.ajax({
        url:'http://macca.myreef.info/weekly_average_tank.txt',
        async:false,
        success: function(data){
                tankseries = data.split(',');        }
});
$.ajax({
        url:'http://macca.myreef.info/weekly_average_heater.txt',
        async:false,
        success: function(data){
                heaterseries = data.split(',');
        }
});
$.ajax({
        url:'http://macca.myreef.info/weekly_average_room.txt',
        async:false,
        success: function(data){
                roomseries = data.split(',');
        }
});
$.ajax({
        url:'http://macca.myreef.info/weekly_average_epoch.txt',
        async:false,
        success: function(data){
                epochseries = data.split(',');
        }
});
//Convert all <x>series from strings to int

for(var i=0, len=phseries.length; i<len; i++)
        {
        phseries[i] = phseries[i]*1;
        }
for(var i=0, len=orpseries.length; i<len; i++)
        {
        orpseries[i] = orpseries[i]*1;
        }
for(var i=0, len=tankseries.length; i <len; i++)
        {
        tankseries[i] = tankseries[i]*1;
        }
for(var i=0, len=heaterseries.length; i <len; i++)
        {
        heaterseries[i] = heaterseries[i]*1;
        }
for(var i=0, len=roomseries.length; i <len; i++)
        {
        roomseries[i] = roomseries[i]*1;
        }
for(var i=0, len=epochseries.length; i <len; i++)
	{
	epochseries[i] = new Date(epochseries[i]/0.001);
	}

//start options for the chart

		var options = {
			credits: {
				enabled: false
			},
			plotOptions: {
				line: {
					marker: {
						enabled: false
					}
				}
			},
			chart: {
				renderTo: 'container',
				type: 'line',
				marginRight: 130,
				marginBottom: 25,
				zoomType: 'x',
				spacingRight: 2
			},
			title: {
				text: 'Weekly history',
				x: -20 //center
			},
			subtitle: {
				text: 'My Tank',
				x: -20
			},
			xAxis: {
				tickInterval:60,
				categories: epochseries
			},
			yAxis: [
				{ //Primary [0]
					title: {
						text: 'orp'
					},
					id: 'ORP',
					opposite: true,
					min: 350,
					max: 450
				},
				{ //Secondary [1]
					title: {
						text: 'pH'
					},
					id: 'pH',
					min: minph*0.9,
					max: maxph*1.1
				},
				{ //Tertiary [2]
					title: {
						text: 'Temp'
					},
				id: 'Temp',
				min: 20,
				max: 30,
				opposite: false
       			}],
			tooltip: {
				crosshairs: true,
				shared: true
			},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'top',
				x: -10,
				borderWidth: 1
			},
			series: [{
				name: 'pH',
				data: phseries,
				yAxis: 'pH'
			}, {
                                name: 'Tank',
                                data: tankseries,
                                yAxis: 'Temp'
			}, {
				name: 'Heater',
				data: heaterseries,
				yAxis: 'Temp'
                        }, {
                                name: 'Room',
                                data: roomseries,
                                yAxis: 'Temp'
			}, {
				name: 'ORP',
				data: orpseries,
				yAxis: 'ORP'
			}]
		};
	var chart = new Highcharts.Chart(options);
});
</script>
		
</head>
	<body>
		<div id="container" style="width: 100%; height: 400px; margin: 0 auto"></div>
<script type="text/javascript">
$.ajax({
        url:'weekly_average_ph.txt',
        async:false,
        success: function(data){
                phseries = data.split(',');
        }
});
$.ajax({
        url:'weekly_average_orp.txt',
        async:false,
        success: function(data){
                orpseries = data.split(',');
        }
});
$.ajax({
        url:'weekly_average_tank.txt',
        async:false,
        success: function(data){
                tankseries = data.split(',');
        }
});
$.ajax({
        url:'weekly_average_heater.txt',
        async:false,
        success: function(data){
                heaterseries = data.split(',');
        }
});
$.ajax({
        url:'weekly_average_room.txt',
        async:false,
        success: function(data){
                roomseries = data.split(',');
        }
});
$.ajax({
        url:'weekly_average_epoch.txt',
        async:false,
        success: function(data){
                epochseries = data.split(',');
        }
});
maxph = 0;
minph = 9;
for(var i=0, len=phseries.length; i<len; i++)
        {
        phseries[i] = parseFloat(phseries[i],10);
	if (phseries[i] > maxph) {
		maxph = phseries[i];
	}
        if (phseries[i] < minph && phseries[i] > 0) {
                minph = phseries[i];
        }

}

heateruse = 0;
for (var i=0, lenhe=heaterseries.length; i<lenhe; i++)
        {
        heaterseries[i] = parseFloat(heaterseries[i],10);
        tankseries[i] = parseFloat(tankseries[i],10);
        if (heaterseries[i] > tankseries[i]+0.5 )  {
                heateruse=++heateruse;
        }
}

epocharraylength = epochseries.length;
pharraylength = phseries.length;
roomarraylength = roomseries.length;
heaterarraylength = heaterseries.length;
tankarraylength = tankseries.length;
document.write ("EpochSeries length is " + epocharraylength + "<BR>");
document.write ("pHSeries length is " + pharraylength + "<BR>");
document.write ("roomSeries length is " + roomarraylength + "<BR>");
document.write ("heaterSeries length is " + heaterarraylength + "<BR>");
document.write ("tankSeries length is " + tankarraylength + "<BR>");
document.write ("Max pH is " + maxph + "<BR>");
document.write ("Min pH is " + minph + "<BR>");
document.write ("Heater use is " + heateruse + "<BR>");
// each Heater use is 5 mins = 1/12 of power at .6kW = 0.083*.6 = 0.05
kw = heateruse*0.05;
kwuse = Math.round(kw*100)/100;
document.write ("Heaters used " + kwuse  + " kW<BR>");
</script>
Test 1
	</body>
</html>
